 # Домашнее задание
Основы работы с Kubernetes (Часть 2)  

## Цель:
В этом ДЗ вы научитесь создавать минимальный сервис.

## Описание/Пошаговая инструкция выполнения домашнего задания:
Создать минимальный сервис, который отвечает на порту 8000 имеет http-метод GET /health/ RESPONSE: {"status": "OK"} Cобрать локально образ приложения в докер. Запушить образ в dockerhub Написать манифесты для деплоя в k8s для этого сервиса. Манифесты должны описывать сущности Deployment, Service, Ingress. В Deployment могут быть указаны Liveness, Readiness пробы. Количество реплик должно быть не меньше 2. Image контейнера должен быть указан с Dockerhub. Хост в ингрессе должен быть arch.homework. В итоге после применения манифестов GET запрос на http://arch.homework/health должен отдавать {“status”: “OK”}. На выходе предоставить
ссылку на github c манифестами. Манифесты должны лежать в одной директории, так чтобы можно было их все применить одной командой kubectl apply -f .
url, по которому можно будет получить ответ от сервиса (либо тест в postmanе).  

Задание со звездой* (+5 баллов): В Ingress-е должно быть правило, которое форвардит все запросы с /otusapp/{student name}/* на сервис с rewrite-ом пути. Где {student name} - это имя студента.

## Критерии оценки:
"Принято" - задание выполнено полностью
"Возвращено на доработку" - задание не выполнено полностью

# Инструкция

Все артефакты созданы для Docker Desktop

## Состав папок
| Папка           | Описание    |
|-----------------| --- |
| /web-app        | веб-сервис для ДЗ|
| /kubernetes     | содержит все ДЗ по теме кубернетес|
| /kubernetes/dz1 | ДЗ по первой теме|

## Сборка web-app
Собрать с использованием gradle
1. Должен быть установлен не особо дремучий Gradle 
2. Из папки web-app выполнить команду ./gradlew bootJar
3. Получившийся артефакт web-app.jar скопировать в папку /kubernetes/dz1

## Создание образа
1. Зайти в папку /kubernetes/dz1
2. В файле create_image.bat проверить актуальность пути к артефакту web-app.jar в переменной SRC
3. Выполнить create_image.bat

## Установка сервиса
Для установки необходим кластер k8s хотя бы с одной нодой.
В проекте используется Docker Desktop
1. Установить Deployment
kubectl apply -f deployment.yaml
2. Установить Service 
kubectl apply -f service.yaml
3. Установить Ingress
kubectl apply -f ingress.yaml

## Удаление
Если установка осуществлялась в конкретный namespace, то достаточно его удалить.
В противном случае необходимо удалить 
1. web-app-ingress-ext
2. web-app-service
3. web-app-deployment

## Настройки Ingress
Ингресс-файл сделан под helm chart  
nginx-ingress-controller-9.2.27  
Не забываем в hosts указать  
127.0.0.1 arch.homework  

## Тестирование
В файле dz.postman_collection.json приведены две ссылки для проверки запросов согласно заданию
Результаты работы команды newman run приведены в файле newman_report.json

1. http://arch.homework/health
2. http://arch.homework/otusapp/poznanin/health
